<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>å­¸ç”Ÿå­¸ç¿’ç‹€æ³åˆ†æç³»çµ±</title>
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #2c3e50; }
        #messages, #student-feedback { margin-top: 20px; white-space: pre-wrap; background: #f9f9f9; padding: 15px; border-radius: 8px; }
        #plot { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>ğŸ“˜ å­¸ç”Ÿå­¸ç¿’å•å·åˆ†æç³»çµ±</h1>

    <form id="upload-form">
        <label for="file">è«‹ä¸Šå‚³å•å· CSV æª”æ¡ˆï¼š</label>
        <input type="file" name="file" id="file" required>
        <button type="submit">ä¸Šå‚³ä¸¦åˆ†æ</button>
    </form>

    <div id="messages">
        <h2>ğŸ“¢ ç³»çµ±è¨Šæ¯</h2>
        <div id="updates"></div>
    </div>

    <div id="plot">
        <h2>ğŸ“Š åœ˜é«”åˆ†æåœ–è¡¨</h2>
        <img id="plot-image" src="" alt="å­¸ç¿’ç‹€æ³åœ–è¡¨" style="max-width: 100%; display: none;">
    </div>

    <div id="student-feedback">
        <h2>ğŸ‘¥ å€‹åˆ¥å»ºè­°</h2>
        <div id="advices"></div>
    </div>

    <script>
        const socket = io();

        socket.on('update', function(data) {
            const updates = document.getElementById('updates');
            updates.innerHTML += 'ğŸŸ¡ ' + data.message + '<br>';
        });

        socket.on('plot_generated', function(data) {
            const plotImg = document.getElementById('plot-image');
            plotImg.src = data.plot_url + '?t=' + new Date().getTime();  // é¿å…å¿«å–
            plotImg.style.display = 'block';
        });

        socket.on('student_advice', function(data) {
            const advices = document.getElementById('advices');
            advices.innerHTML += 'ğŸ“ ' + data.message + '<br><br>';
        });

        // é˜²æ­¢è¡¨å–®è·³é ï¼Œæ”¹ç”¨ AJAX ä¸Šå‚³
        document.getElementById('upload-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData();
            const fileInput = document.getElementById('file');
            if (fileInput.files.length === 0) return;

            formData.append('file', fileInput.files[0]);

            fetch('/upload', {
                method: 'POST',
                body: formData
            }).then(response => {
                if (response.ok) {
                    console.log("âœ… æª”æ¡ˆæˆåŠŸä¸Šå‚³");
                } else {
                    alert("âŒ ä¸Šå‚³å¤±æ•—");
                }
            });
        });
    </script>
</body>
</html>
